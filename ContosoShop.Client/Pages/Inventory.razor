@page "/inventory"
@using ContosoShop.Shared.DTOs
@inject HttpClient Http
@inject NavigationManager Navigation
@attribute [Microsoft.AspNetCore.Authorization.Authorize]

<PageTitle>Inventory - ContosoShop</PageTitle>

<h1>Inventory Management</h1>

@if (inventoryData == null)
{
    <p><em>Loading inventory data...</em></p>
}
else if (inventoryData.Count == 0)
{
    <div class="alert alert-info">
        <h4 class="alert-heading">No Inventory</h4>
        <p>There are no products in the inventory.</p>
    </div>
}
else
{
    <div class="mb-3">
        <h5>Inventory Summary</h5>
        <p>Total Products: <strong>@inventoryData.Count</strong></p>
        <p>Total Inventory Items: <strong>@inventoryData.Sum(i => i.TotalInventory)</strong></p>
        <p>Available Stock: <strong>@inventoryData.Sum(i => i.AvailableStock)</strong></p>
        <p>Reserved Stock: <strong>@inventoryData.Sum(i => i.ReservedStock)</strong></p>
        <p>Items with Return History: <strong>@inventoryData.Sum(i => i.ReturnedItems)</strong></p>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>Item Number</th>
                    <th>Product Name</th>
                    <th>Price</th>
                    <th>Weight</th>
                    <th>Size</th>
                    <th class="text-center">Total Inventory</th>
                    <th class="text-center">Available</th>
                    <th class="text-center">Reserved</th>
                    <th class="text-center">Returned</th>
                    <th class="text-center">Stock Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in inventoryData)
                {
                    <tr>
                        <td><code>@item.ItemNumber</code></td>
                        <td>@item.Name</td>
                        <td>@item.Price.ToString("C")</td>
                        <td>@item.Weight.ToString("0.0") lbs</td>
                        <td><span class="badge bg-secondary">@item.Dimensions</span></td>
                        <td class="text-center"><strong>@item.TotalInventory</strong></td>
                        <td class="text-center">
                            <span class="badge bg-success">@item.AvailableStock</span>
                        </td>
                        <td class="text-center">
                            @if (item.ReservedStock > 0)
                            {
                                <span class="badge bg-warning text-dark">@item.ReservedStock</span>
                            }
                            else
                            {
                                <span class="text-muted">0</span>
                            }
                        </td>
                        <td class="text-center">
                            @if (item.ReturnedItems > 0)
                            {
                                <span class="badge bg-info">@item.ReturnedItems</span>
                            }
                            else
                            {
                                <span class="text-muted">0</span>
                            }
                        </td>
                        <td class="text-center">
                            @if (item.AvailableStock == 0)
                            {
                                <span class="badge bg-danger">Out of Stock</span>
                            }
                            else if (item.AvailableStock < 20)
                            {
                                <span class="badge bg-warning text-dark">Low Stock</span>
                            }
                            else
                            {
                                <span class="badge bg-success">In Stock</span>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}

@code {
    private List<InventorySummary>? inventoryData;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            inventoryData = await Http.GetFromJsonAsync<List<InventorySummary>>("api/inventory");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading inventory: {ex.Message}");
            inventoryData = new List<InventorySummary>();
        }
    }
}
